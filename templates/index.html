<!doctype html>
<html lang="en">
<head>

    <!-- Webpage Title -->
    <title>Home | í˜¼ë°¥ì€ ì‹«ì–´</title>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>
    <!-- Bulma CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">
    <!-- Font Awesome CSS -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!--mystyle.css-->
    <link href="{{ url_for('static', filename='mystyle.css') }}" rel="stylesheet">
    
    <!-- êµ¬ê¸€ í°íŠ¸ -->
    <link href="https://fonts.googleapis.com/css2?family=Dongle:wght@300&family=Jua&display=swap" rel="stylesheet">

    <style>
    </style>


    <script>
         function sign_out() {
            $.removeCookie('mytoken', {path: '/'});
            alert('ë¡œê·¸ì•„ì›ƒ!')
            window.location.href = "/login"
        }
        function searchAddress() {
            $("#search_result").empty()
            $("#chosen_one").empty()
            if ($("#place").val() == "") {
                alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”")
            } else {
                var q = $("#place").val(); //ê²€ìƒ‰ ë‚´ìš©
                //ajax ì‹œì‘
                $.ajax({
                    url: 'https://dapi.kakao.com//v2/local/search/keyword',
                    headers: {'Authorization': 'KakaoAK d1e860dcc4958625477d32113326c5ee'},
                    type: 'GET',
                    data: {'query': q},
                    success: function (response) {
                        //í˜¸ì¶œ ì„±ê³µí•˜ë©´ ì‘ì„±í•  ë‚´ìš©
                        let rows = response['documents']
                        for (let i = 0; i < rows.length; i++) {
                            let id = rows[i]['id']
                            let place = rows[i]['place_name']
                            let address = rows[i]['address_name']
                            let url = rows[i]['place_url']
                            let category = rows[i]['category_name']



                            if (rows[i]['category_group_code'] == "FD6") {

                                let temp_html = `<button type="button" class="button" onclick="hey(${id})">
                                            <div class="row g-0">
                                                <div class="col-md-8">
                                                    <div class="card-body">
                                                        <h5 class="card-title">${place}</h5>
                                                        <p class="card-text">${address}</p>
                                                        <p class="card-text">${category}</p>
                                                        <p class="card-text"><small class="text-muted">${url}</small></p>
                                                    </div>
                                                </div>
                                            </div>
                                        </button>`

                                $("#search_result").append(temp_html)
                            }
                        }

                        console.log(rows)
                    },
                    error: function (request, status, error) {
                        alert("code:" + request.status + "\n" + "message:" + request.responseText + "\n" + "error:" + error);
                    }
                })
            }
        }

        function hey(a) {
            $("#search_result").empty()
            if ($("#place").val() == "") {
                alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”")
            } else {
                var q = $("#place").val(); //ê²€ìƒ‰ ë‚´ìš©
                //ajax ì‹œì‘
                $.ajax({
                    url: 'https://dapi.kakao.com//v2/local/search/keyword',
                    headers: {'Authorization': 'KakaoAK d1e860dcc4958625477d32113326c5ee'},
                    type: 'GET',
                    data: {'query': q},
                    success: function (response) {
                        //í˜¸ì¶œ ì„±ê³µí•˜ë©´ ì‘ì„±í•  ë‚´ìš©
                        let rows = response['documents']
                        for (let i = 0; i < rows.length; i++) {
                            if (rows[i]['id'] == a) {
                                let id = rows[i]['id']
                                let place = rows[i]['place_name']
                                let address = rows[i]['address_name']
                                let url = rows[i]['place_url']
                                let category = rows[i]['category_name']

                                let temp_html = `<button type="button" class="button">
                                            <div class="row g-0">
                                                <div class="col-md-8">
                                                    <div class="card-body">
                                                        <h5 class="card-title" id="cp">${place}</h5>
                                                        <p class="card-text" id="ca">${address}</p>
                                                        <p class="card-text" id="cc">${category}</p>
                                                        <p class="card-text"><small class="text-muted" id="cu">${url}</small></p>
                                                    </div>
                                                </div>
                                            </div>
                                        </button>`

                                $("#chosen_one").append(temp_html)
                            }

                        }

                    },
                })
            }
        }

        function posting() {

            let place = $("#cp").text()
            let address = $("#ca").text()
            let url = $("#cu").text()
            let date = $("#date").val()
            let category = $("#cc").text()

            $.ajax({
                type: 'POST',
                url: '/posting',
                data: {
                    title_give: $("#title").val(),
                    place_give: place,
                    address_give: address,
                    desc_give: $("#desc").val(),
                    tag_give: $("#tag").val(),
                    url_give: url,
                    payment_give: $("#payment").val(),
                    datenow_give: new Date().toISOString(),
                    date_give: date,
                    category_give: category,
                    time_give: $("#time").val(),
                    maxcount_give: $("#maxcount").val()
                },
                success: function (response) {
                    alert(response['msg'])
                    window.location.reload()
                }
            });
        }

        function key_search() {
            $("#post-box").empty()
            let keyword = $("#key_m").val()
            let pdate = $("#date_m").val()
            $.ajax({
                type: 'GET',
                url: "/database",
                data: {},
                success: function (response) {
                    let rows = response['posts']
                    for (let i = 0; i < rows.length; i++) {
                        let title = rows[i]['title']
                        let place = rows[i]['place']
                        let address = rows[i]['address']
                        let tag = rows[i]['tag']
                        let adate = rows[i]['date']
                        let category = rows[i]['category']
                        let post_id = rows[i]['post_id']
                        if (adate != pdate) {}
                        else {
                            if (title.includes(keyword)||place.includes(keyword)||address.includes(keyword)||tag.includes(keyword)) {
                                console.log(title,place,address,tag,adate)

                                let temp_html = `<div class="col">
                                                    <div class="card h-100">
                                                        <div class="card-body">
                                                            <h5 class="card-title">${place}</h5>
                                                            <h6 class="card-subtitle mb-2 text-muted">${category}</h6>
                                                            <p class="card-text">${adate}</p>
                                                            <p class="card-text">${address}</p>
                                                            <a href="detail/${post_id}" class="btn btn-outline-warning" style="margin-top: 10px">ë” ìì„¸íˆ ë³´ê¸°</a>
                                                        </div>
                                                    </div>
                                                </div>`

                                $("#post-box").append(temp_html)

                            }
                        }



                    }
                }
            })
        }

    </script>

</head>
<body>
<nav class="navbar is-fixed-top is-white" role="navigation" aria-label="main navigation">
    <div class="navbar-brand">
        <a class="navbar-item" href="/">
            <strong class="is-sparta"
                    style="font-family: 'Dongle', sans-serif;font-size: larger;color: #2f4759 !important;">ğŸ˜¢ í˜¼ë°¥ì€ ì‹«ì–´</strong>
        </a>
    </div>
    <figure class="media-left" style="align-self: center">
        <a class="image is-32x32" href="/user/{{ user_info.id }}">
            <img class="is-rounded" src="{{ url_for("static", filename="profile_pics/profile_placeholder.png") }}">
        </a>
        <p>{{ user_info.id }} ë‹˜</p>
        <a class="button level-item has-text-centered is-sparta is-outlined" aria-label="logout"
           onclick="sign_out()">
            ë¡œê·¸ì•„ì›ƒ&nbsp;&nbsp;&nbsp;<span class="icon is-small"><i class="fa fa-sign-out"
                                                                 aria-hidden="true"></i></span>
        </a>
    </figure>
</nav>
<section class="section">
    <article class="media">
{#        <figure class="media-left" style="align-self: center">#}
{#            <a class="image is-32x32" href="/user/{{ user_info.id }}">#}
{#                <img class="is-rounded" src="{{ url_for('static', filename=user_info.profile_pic_real) }}">#}
{#            </a>#}
{#        </figure>#}
        <div class="media-content">
            <div class="field">
                <p class="control">
                    <button class="button is-danger is-rounded" id="input-post"
                           onclick='$("#modal-post").addClass("is-active")' style="background-color: #e7b934;">ì˜¤ëŠ˜ì˜ ë°¥ ì¹œêµ¬ ë§Œë“¤ê¸°</button>
                </p>
            </div>
        </div>
    </article>
    {#            í¬ìŠ¤íŒ… í•  ìˆ˜ ìˆëŠ” ê³³#}
    <div class="modal" id="modal-post">
        <div class="modal-background" onclick='$("#modal-post").removeClass("is-active")'></div>
        <div class="modal-content">
            <div class="mypost">
    <div class="form-floating">
        <textarea class="form-control" placeholder="ì œëª©" id="title"></textarea>
        <label for="title">ì—¬ê¸°ì— í¬ìŠ¤íŒ… ì œëª©ì„ ì ì–´ì£¼ì„¸ìš”</label>
    </div>
    <div class="input-group mb-3">
        <input type="text" class="form-control" placeholder="" aria-label="ë‚´ê°€ ê°€ê³ ì‹¶ì€ ê³³ì€ ì—¬ê¸°!"
               aria-describedby="button-addon2" id="place">
        <button class="btn btn-outline-secondary" type="button" onclick="searchAddress()">ì‹ë‹¹ ê²€ìƒ‰í•˜ê¸°
        </button>
    </div>
    <div id="chosen_one">
    </div>
    <div id="search_result">
    </div>
    <div>
        <div class="form-floating mb-3">
            <input type="date" class="form-control" id="date" placeholder="">
            <label for="date">ë‚ ì§œë¥¼ ì •í•˜ì„¸ìš”</label>
        </div>
        <div class="form-floating mb-3">
            <input type="time" class="form-control" id="time" placeholder="">
            <label for="time">ì‹œê°„ì„ ì •í•˜ì„¸ìš”</label>
        </div>
    </div>
    <div class="row g-2" id="catset">
        <div class="col-md">
            <div class="form-floating">
                <select class="form-select" id="payment" aria-label="Floating label select example">
                    <option selected>--ê²°ì œ ë°©ì‹--</option>
                    <option value="ë‚´.ëˆ.ë‚´.ë¨¹.">ë‚´.ëˆ.ë‚´.ë¨¹.</option>
                    <option value="ë¬´ì¡°ê±´ n ë¶„ì˜ 1 ë¹µ">ë¬´ì¡°ê±´ n ë¶„ì˜ 1 ë¹µ</option>
                    <option value="ì˜¤ëŠ˜ì€ ë‚´ê°€ ìœë‹¤!">ì˜¤ëŠ˜ì€ ë‚´ê°€ ìœë‹¤!</option>
                    <option value="ë¬´ì „ì·¨ì‹ - ë°œë¹ ë¥´ì‹  ë¶„ë§Œ">ë¬´ì „ì·¨ì‹ - ë°œë¹ ë¥´ì‹  ë¶„ë§Œ</option>
                </select>

                <label for=payment>ì˜¤ëŠ˜ì˜ ë¬¼ì£¼ëŠ” ëˆ„êµ¬?</label>
            </div>
        </div>
        <div class="col-md">
            <div class="form-floating">
                <select class="form-select" id="maxcount" aria-label="Floating label select example">
                    <option selected>--ìµœëŒ€ ì¸ì›ìˆ˜--</option>
                    <option value="1">1ëª…</option>
                    <option value="2">2ëª…</option>
                    <option value="3">3ëª…</option>
                    <option value="4">PARTY TONIGHT!</option>
                </select>
                <label for="maxcount">ëª‡ëª…ê¹Œì§€ ì»¤ë²„ ê°€ëŠ¥?</label>
            </div>
        </div>
    </div>
    <div class="form-floating">
        <textarea class="form-control" placeholder="ì—¬ê¸°ì— ê¼­ ê°€ì•¼í•˜ëŠ” ì´ìœ !" id="desc"
                  style="height: 200px"></textarea>
        <label for="desc">ì—¬ê¸°ì— ê¼­ ê°€ì•¼í•˜ëŠ” ì´ìœ !</label>
    </div>
    <div class="form-floating">
        <textarea class="form-control" placeholder="íƒœê·¸ ë‹¬ê¸°" id="tag"></textarea>
        <label for="tag">íƒœê·¸ëŠ” ì—¬ê¸°ì— ë‹¬ì•„ì£¼ì„¸ìš”</label>
    </div>
    <div class="btnset">
        <button onclick="posting()" type="button" class="btn btn-primary">ê°€ì•ì¦ˆì•„ì•„ì•„ì•„ì•„ì•„ì•„ì•„!</button>
        <button onclick="test()" type="button" class="btn btn-danger" id="stop">ì ê¹ ì´ê±° ì•„ë‹Œê±° ê°™ì• </button>
    </div>
</div>
</div>
               </div>
            </section>
        </div>
    </div>
    <button class="modal-close is-large" aria-label="close"
            onclick='$("#modal-post").removeClass("is-active")'></button>
    </div>
</section>


{#        í¬ìŠ¤íŒ…ëœ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ê³³#}
<section class="section">
    <div class="row g-2">
        <div class="col-md">
            <div class="form-floating">
                <input type="date" class="form-control" id="date_m" placeholder=""
                       value="">
                <label for="date_m">ë‚ ì§œëŠ” ì—¬ê¸°ì—</label>
            </div>
        </div>
        <div class="col-md">
            <div class="input-group mb-3">
                <input type="text" id="key_m" style="height: 58px" class="form-control" placeholder="í‚¤ì›Œë“œëŠ” ì—¬ê¸°"
                       aria-label="Recipient's username" aria-describedby="button-addon2">
                <button class="btn btn-outline-secondary" type="button" onclick="key_search()">ê²€ìƒ‰í•˜ê¸°</button>
            </div>
        </div>
    </div>
    <div class="container" style="margin-top: 20px">
        <div class="row row-cols-1 row-cols-md-3 g-4" id="post-box">
            {% for post in posts %}
                {% set place = post["place"] %}
                {% set address = post["address"] %}
                {% set date = post["date"] + " " + post["time"] %}
                {% set category = post["category"] %}

                <div class="col">
                    <div class="card h-100">
                        <div class="card-body">
                            <h5 class="card-title">{{ place }}</h5>
                            <h6 class="card-subtitle mb-2 text-muted">{{ category }}</h6>
                            <p class="card-text">{{ date }}</p>
                            <p class="card-text">{{ address }}</p>
                            <a href="detail/{{ post["post_id"] }}" class="btn btn-outline-warning" style="margin-top: 10px">ë” ìì„¸íˆ ë³´ê¸°</a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>

    </div>
</section>
</body>
</html>
